<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 dbt Expectations package | A guide to using dbt with Google BigQuery</title>
  <meta name="description" content="This book is your manual to using dbt with BigQuery." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 dbt Expectations package | A guide to using dbt with Google BigQuery" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/./images/home-page-pic.png" />
  <meta property="og:description" content="This book is your manual to using dbt with BigQuery." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 dbt Expectations package | A guide to using dbt with Google BigQuery" />
  
  <meta name="twitter:description" content="This book is your manual to using dbt with BigQuery." />
  <meta name="twitter:image" content="/./images/home-page-pic.png" />

<meta name="author" content="Samuel Gachuhi Ngugi" />


<meta name="date" content="2024-12-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tests-1.html"/>
<link rel="next" href="seeds.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#resources"><i class="fa fa-check"></i><b>1.1</b> Resources</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#copyright"><i class="fa fa-check"></i><b>1.2</b> Copyright</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#what-is-dbt"><i class="fa fa-check"></i><b>2.1</b> What is dbt?</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#encounter-with-dbt"><i class="fa fa-check"></i><b>2.2</b> Encounter with <code>dbt</code></a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#dbt-from-the-professionals"><i class="fa fa-check"></i><b>2.3</b> dbt, from the professionals…</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#why-use-dbt"><i class="fa fa-check"></i><b>2.4</b> Why use dbt?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html"><i class="fa fa-check"></i><b>3</b> The <code>dbt</code> architecture</a>
<ul>
<li class="chapter" data-level="3.1" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#models"><i class="fa fa-check"></i><b>3.1</b> Models</a></li>
<li class="chapter" data-level="3.2" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#tests"><i class="fa fa-check"></i><b>3.2</b> Tests</a></li>
<li class="chapter" data-level="3.3" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#documentation"><i class="fa fa-check"></i><b>3.3</b> Documentation</a></li>
<li class="chapter" data-level="3.4" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#sources"><i class="fa fa-check"></i><b>3.4</b> Sources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-storage.html"><a href="data-storage.html"><i class="fa fa-check"></i><b>4</b> Data storage</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-storage.html"><a href="data-storage.html#data-warehouse"><i class="fa fa-check"></i><b>4.1</b> Data warehouse</a></li>
<li class="chapter" data-level="4.2" data-path="data-storage.html"><a href="data-storage.html#data-lake"><i class="fa fa-check"></i><b>4.2</b> Data lake</a></li>
<li class="chapter" data-level="4.3" data-path="data-storage.html"><a href="data-storage.html#data-lakehouse"><i class="fa fa-check"></i><b>4.3</b> Data lakehouse</a></li>
<li class="chapter" data-level="4.4" data-path="data-storage.html"><a href="data-storage.html#a-brief-history"><i class="fa fa-check"></i><b>4.4</b> A brief history</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html"><i class="fa fa-check"></i><b>5</b> Our data in BigQuery</a>
<ul>
<li class="chapter" data-level="5.1" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html#accessing-big-query"><i class="fa fa-check"></i><b>5.1</b> Accessing Big Query</a></li>
<li class="chapter" data-level="5.2" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html#copying-the-new-york-city-bikes-data"><i class="fa fa-check"></i><b>5.2</b> Copying the New York City Bikes data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="installing-dbt.html"><a href="installing-dbt.html"><i class="fa fa-check"></i><b>6</b> Installing dbt</a>
<ul>
<li class="chapter" data-level="6.1" data-path="installing-dbt.html"><a href="installing-dbt.html#setting-the-environment"><i class="fa fa-check"></i><b>6.1</b> Setting the environment</a></li>
<li class="chapter" data-level="6.2" data-path="installing-dbt.html"><a href="installing-dbt.html#connecting-to-your-bigquery-data-warehouse"><i class="fa fa-check"></i><b>6.2</b> Connecting to your BigQuery data warehouse</a></li>
<li class="chapter" data-level="6.3" data-path="installing-dbt.html"><a href="installing-dbt.html#initializing-a-dbt-project"><i class="fa fa-check"></i><b>6.3</b> Initializing a dbt project</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="models-1.html"><a href="models-1.html"><i class="fa fa-check"></i><b>7</b> Models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="models-1.html"><a href="models-1.html#running-a-model"><i class="fa fa-check"></i><b>7.1</b> Running a model</a></li>
<li class="chapter" data-level="7.2" data-path="models-1.html"><a href="models-1.html#model-structure"><i class="fa fa-check"></i><b>7.2</b> Model structure</a></li>
<li class="chapter" data-level="7.3" data-path="models-1.html"><a href="models-1.html#a-custom-model"><i class="fa fa-check"></i><b>7.3</b> A custom model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="documentation-1.html"><a href="documentation-1.html"><i class="fa fa-check"></i><b>8</b> Documentation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="documentation-1.html"><a href="documentation-1.html#the-yml-files"><i class="fa fa-check"></i><b>8.1</b> The yml files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="documentation-1.html"><a href="documentation-1.html#version-2"><i class="fa fa-check"></i><b>8.1.1</b> <code>version: 2</code></a></li>
<li class="chapter" data-level="8.1.2" data-path="documentation-1.html"><a href="documentation-1.html#models-2"><i class="fa fa-check"></i><b>8.1.2</b> <code>models</code></a></li>
<li class="chapter" data-level="8.1.3" data-path="documentation-1.html"><a href="documentation-1.html#description"><i class="fa fa-check"></i><b>8.1.3</b> <code>description</code></a></li>
<li class="chapter" data-level="8.1.4" data-path="documentation-1.html"><a href="documentation-1.html#columns"><i class="fa fa-check"></i><b>8.1.4</b> <code>columns</code></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="documentation-1.html"><a href="documentation-1.html#definition-for-our-model"><i class="fa fa-check"></i><b>8.2</b> Definition for our model</a></li>
<li class="chapter" data-level="8.3" data-path="documentation-1.html"><a href="documentation-1.html#using-the-doc-function"><i class="fa fa-check"></i><b>8.3</b> Using the <code>doc</code> function</a></li>
<li class="chapter" data-level="8.4" data-path="documentation-1.html"><a href="documentation-1.html#images-in-dbt-documentation"><i class="fa fa-check"></i><b>8.4</b> Images in dbt documentation</a></li>
<li class="chapter" data-level="8.5" data-path="documentation-1.html"><a href="documentation-1.html#generating-the-document"><i class="fa fa-check"></i><b>8.5</b> Generating the document</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tests-1.html"><a href="tests-1.html"><i class="fa fa-check"></i><b>9</b> Tests</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tests-1.html"><a href="tests-1.html#types-of-tests-in-dbt"><i class="fa fa-check"></i><b>9.1</b> Types of tests in dbt</a></li>
<li class="chapter" data-level="9.2" data-path="tests-1.html"><a href="tests-1.html#generic-tests-in-dbt"><i class="fa fa-check"></i><b>9.2</b> Generic tests in dbt</a></li>
<li class="chapter" data-level="9.3" data-path="tests-1.html"><a href="tests-1.html#singular-tests-in-dbt"><i class="fa fa-check"></i><b>9.3</b> Singular tests in dbt</a></li>
<li class="chapter" data-level="9.4" data-path="tests-1.html"><a href="tests-1.html#creating-a-generic-test"><i class="fa fa-check"></i><b>9.4</b> Creating a generic test</a></li>
<li class="chapter" data-level="9.5" data-path="tests-1.html"><a href="tests-1.html#configuring-custom-generic-tests"><i class="fa fa-check"></i><b>9.5</b> Configuring custom generic tests</a></li>
<li class="chapter" data-level="9.6" data-path="tests-1.html"><a href="tests-1.html#storing-test-failures"><i class="fa fa-check"></i><b>9.6</b> Storing test failures</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html"><i class="fa fa-check"></i><b>10</b> dbt Expectations package</a>
<ul>
<li class="chapter" data-level="10.1" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#dbt-expectations-installation"><i class="fa fa-check"></i><b>10.1</b> <code>dbt-expectations</code> installation</a></li>
<li class="chapter" data-level="10.2" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#types-of-dbt-expectations-tests"><i class="fa fa-check"></i><b>10.2</b> Types of <code>dbt-expectations</code> tests</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#table-shape"><i class="fa fa-check"></i><b>10.2.1</b> Table shape</a></li>
<li class="chapter" data-level="10.2.2" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#missing-values-unique-values-and-types"><i class="fa fa-check"></i><b>10.2.2</b> Missing values, unique values, and types</a></li>
<li class="chapter" data-level="10.2.3" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#sets-and-ranges"><i class="fa fa-check"></i><b>10.2.3</b> Sets and Ranges</a></li>
<li class="chapter" data-level="10.2.4" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#string-matching"><i class="fa fa-check"></i><b>10.2.4</b> String matching</a></li>
<li class="chapter" data-level="10.2.5" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#aggregate"><i class="fa fa-check"></i><b>10.2.5</b> Aggregate</a></li>
<li class="chapter" data-level="10.2.6" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#multi-column"><i class="fa fa-check"></i><b>10.2.6</b> Multi-column</a></li>
<li class="chapter" data-level="10.2.7" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#distributional-functions"><i class="fa fa-check"></i><b>10.2.7</b> Distributional functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="seeds.html"><a href="seeds.html"><i class="fa fa-check"></i><b>11</b> Seeds</a>
<ul>
<li class="chapter" data-level="11.1" data-path="seeds.html"><a href="seeds.html#uploading-a-seed-into-your-data-warehouse"><i class="fa fa-check"></i><b>11.1</b> Uploading a seed into your data warehouse</a></li>
<li class="chapter" data-level="11.2" data-path="seeds.html"><a href="seeds.html#referencing-seeds-in-models"><i class="fa fa-check"></i><b>11.2</b> Referencing seeds in models</a></li>
<li class="chapter" data-level="11.3" data-path="seeds.html"><a href="seeds.html#seed-configurations-at-project-level"><i class="fa fa-check"></i><b>11.3</b> Seed Configurations at project level</a></li>
<li class="chapter" data-level="11.4" data-path="seeds.html"><a href="seeds.html#seed-properties-and-configurations-at-properties-level"><i class="fa fa-check"></i><b>11.4</b> Seed properties and configurations at properties level</a></li>
<li class="chapter" data-level="11.5" data-path="seeds.html"><a href="seeds.html#performing-tests-on-seeds"><i class="fa fa-check"></i><b>11.5</b> Performing tests on seeds</a></li>
<li class="chapter" data-level="11.6" data-path="seeds.html"><a href="seeds.html#viewing-documentation-for-dbt-seeds"><i class="fa fa-check"></i><b>11.6</b> Viewing documentation for dbt seeds</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="sources-1.html"><a href="sources-1.html"><i class="fa fa-check"></i><b>12</b> Sources</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sources-1.html"><a href="sources-1.html#defining-a-source"><i class="fa fa-check"></i><b>12.1</b> Defining a source</a></li>
<li class="chapter" data-level="12.2" data-path="sources-1.html"><a href="sources-1.html#referencing-sources"><i class="fa fa-check"></i><b>12.2</b> Referencing sources</a></li>
<li class="chapter" data-level="12.3" data-path="sources-1.html"><a href="sources-1.html#defining-properties-in-a-sources-file"><i class="fa fa-check"></i><b>12.3</b> Defining properties in a <code>sources</code> file</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="snapshots.html"><a href="snapshots.html"><i class="fa fa-check"></i><b>13</b> Snapshots</a>
<ul>
<li class="chapter" data-level="13.1" data-path="snapshots.html"><a href="snapshots.html#create-a-snapshot"><i class="fa fa-check"></i><b>13.1</b> Create a snapshot</a></li>
<li class="chapter" data-level="13.2" data-path="snapshots.html"><a href="snapshots.html#the-check-strategy"><i class="fa fa-check"></i><b>13.2</b> The <code>check</code> strategy</a></li>
<li class="chapter" data-level="13.3" data-path="snapshots.html"><a href="snapshots.html#the-timestamp-strategy"><i class="fa fa-check"></i><b>13.3</b> The <code>timestamp</code> strategy</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="analyses.html"><a href="analyses.html"><i class="fa fa-check"></i><b>14</b> Analyses</a>
<ul>
<li class="chapter" data-level="14.1" data-path="analyses.html"><a href="analyses.html#creating-an-analysis"><i class="fa fa-check"></i><b>14.1</b> Creating an <code>analysis</code></a></li>
<li class="chapter" data-level="14.2" data-path="analyses.html"><a href="analyses.html#definitions-for-analyses"><i class="fa fa-check"></i><b>14.2</b> Definitions for <code>analyses</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="exposures.html"><a href="exposures.html"><i class="fa fa-check"></i><b>15</b> Exposures</a>
<ul>
<li class="chapter" data-level="15.1" data-path="exposures.html"><a href="exposures.html#creating-an-exposure"><i class="fa fa-check"></i><b>15.1</b> Creating an exposure</a></li>
<li class="chapter" data-level="15.2" data-path="exposures.html"><a href="exposures.html#running-an-exposure"><i class="fa fa-check"></i><b>15.2</b> Running an exposure</a></li>
<li class="chapter" data-level="15.3" data-path="exposures.html"><a href="exposures.html#visualizing-the-exposure"><i class="fa fa-check"></i><b>15.3</b> Visualizing the exposure</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="jinja.html"><a href="jinja.html"><i class="fa fa-check"></i><b>16</b> Jinja</a>
<ul>
<li class="chapter" data-level="16.1" data-path="jinja.html"><a href="jinja.html#a-simple-jinja-statement"><i class="fa fa-check"></i><b>16.1</b> A simple jinja statement</a></li>
<li class="chapter" data-level="16.2" data-path="jinja.html"><a href="jinja.html#a-more-complex-jinja-query"><i class="fa fa-check"></i><b>16.2</b> A more complex jinja query</a></li>
<li class="chapter" data-level="16.3" data-path="jinja.html"><a href="jinja.html#improvising-using-dry-principle"><i class="fa fa-check"></i><b>16.3</b> Improvising using DRY Principle</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="macros.html"><a href="macros.html"><i class="fa fa-check"></i><b>17</b> Macros</a>
<ul>
<li class="chapter" data-level="17.1" data-path="macros.html"><a href="macros.html#invoking-a-macro"><i class="fa fa-check"></i><b>17.1</b> Invoking a macro</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="macros.html"><a href="macros.html#invoking-a-macro-using-expression-blocks"><i class="fa fa-check"></i><b>17.1.1</b> Invoking a macro using expression blocks</a></li>
<li class="chapter" data-level="17.1.2" data-path="macros.html"><a href="macros.html#invoke-a-macro-using-call-blocks"><i class="fa fa-check"></i><b>17.1.2</b> Invoke a macro using call blocks</a></li>
<li class="chapter" data-level="17.1.3" data-path="macros.html"><a href="macros.html#invoke-a-macro-from-the-command-line-interface-cli"><i class="fa fa-check"></i><b>17.1.3</b> Invoke a macro from the Command Line Interface (CLI)</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="macros.html"><a href="macros.html#simple-macro"><i class="fa fa-check"></i><b>17.2</b> Simple macro</a></li>
<li class="chapter" data-level="17.3" data-path="macros.html"><a href="macros.html#complex-macro"><i class="fa fa-check"></i><b>17.3</b> Complex macro</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="hooks.html"><a href="hooks.html"><i class="fa fa-check"></i><b>18</b> Hooks</a>
<ul>
<li class="chapter" data-level="18.1" data-path="hooks.html"><a href="hooks.html#post-hooks"><i class="fa fa-check"></i><b>18.1</b> Post-hooks</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html"><i class="fa fa-check"></i><b>19</b> Hosting dbt generated documentation</a>
<ul>
<li class="chapter" data-level="19.1" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html#preparations"><i class="fa fa-check"></i><b>19.1</b> Preparations</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html#creating-a-gh-pages-branch"><i class="fa fa-check"></i><b>19.1.1</b> Creating a <code>gh-pages</code> branch</a></li>
<li class="chapter" data-level="19.1.2" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html#tracking-the-target-folder"><i class="fa fa-check"></i><b>19.1.2</b> Tracking the <code>target</code> folder</a></li>
<li class="chapter" data-level="19.1.3" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html#pushing-to-github"><i class="fa fa-check"></i><b>19.1.3</b> Pushing to Github</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="hosting-dbt-generated-documentation.html"><a href="hosting-dbt-generated-documentation.html#hosting-on-github"><i class="fa fa-check"></i><b>19.2</b> Hosting on Github</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>20</b> Conclusion</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A guide to using dbt with Google BigQuery</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dbt-expectations-package" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> dbt Expectations package<a href="dbt-expectations-package.html#dbt-expectations-package" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>What is dbt-expectations? dbt-expectations is an extension package for dbt which works much akin to the Great Expectations package for Python. It was intentionally designed to provide Great Expectations like features in dbt, but now from dbt itself rather than integrating Great Expectations (GE).</p>
<p>Unless you’ve used GE, you may be wondering what this is in the first place, and its okay to feel lost. GE is much like tests in the previous chapter, it conducts quality tests on your data, thus flagging those that deviate from the set assertions.</p>
<p>I would put dbt-expectations and GE on the same plane and use an allegory to drive the point home: that of a car. When buying a car, there are some common checklist items, and others bespoke depending on your car model. For example, an ordinary car must have the following features (at least most of them):</p>
<ul>
<li>have four wheels</li>
<li>have a driver’s seat</li>
<li>have a gear (whether manual or automatic)</li>
<li>have headlights</li>
<li>have a windshield</li>
</ul>
<p>The above list can go on and on depending on your knowledge of cars. But your checklist can also contain some unique items, but which are a must-have depending on your car make. For example, here is a checklist of the Volvo XC60 T6:</p>
<ul>
<li>0.9l/100km fuel consumption</li>
<li>Allowed emissions 22g/km (the less the better)</li>
<li>Hybrid fuel type</li>
</ul>
<p>So if you go to a showrooms and the beautiful or handsome sales agent takes you to the Volvo XC60, you will be perusing it as you cross your checklist. dbt-expectations and GE work in the same way.</p>
<div id="dbt-expectations-installation" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> <code>dbt-expectations</code> installation<a href="dbt-expectations-package.html#dbt-expectations-installation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>According to the <a href="https://hub.getdbt.com/calogica/dbt_expectations/latest/">documentation</a> dbt-expectations will work for dbt versions 1.7x and higher. Let’s first pass this little test.</p>
<pre><code>dbt --version</code></pre>
<p>If you get your dbt-core version is above 1.7x, then you can proceed. If not, you need to update your dbt. You can do so using <code>python -m pip install --upgrade dbt-core</code> or if you want to be more specific, this will do: <code>python -m pip install --upgrade dbt-core==0.19.0</code>.</p>
<p>Ours, at the moment of writing this book, was version <code>1.8.7</code>. Therefore we have a clean bill of health to proceed.</p>
<p>dbt-expectations isn’t installed in the same <em>type and enter</em> kind of means like we did for <code>dbt-core</code> and <code>dbt big-query</code>. Nevertheless, some code is written in some YAML files and from henceforth dbt recognises it.</p>
<p>First create a <code>packages.yml</code> file in the same level as your <code>dbt_project.yml</code> file. You can do so by running this command:</p>
<pre><code>touch packages.yml</code></pre>
<p>On the <code>packages.yml</code> file, insert the following:</p>
<pre><code>packages:
  - package: calogica/dbt_expectations
    version: [&quot;&gt;=0.10.0&quot;, &quot;&lt;0.11.0&quot;]</code></pre>
<p>Apart from that, the <code>dbt-date</code> dependency must also be installed. This is because <code>dbt-expectations</code> references it. However, this will be installed in the <code>dbt_project.yml</code> file rather than the <code>packages.yml</code> file. So inside the <code>dbt_project.yml</code> paste the following just before the <code>materializations</code> dictionary.</p>
<pre><code>vars:
  &#39;dbt_date:time_zone&#39;: &#39;Africa/Nairobi&#39;</code></pre>
<p>You may insert any valid timezone apart from the one specified above, but we highly suggest that you use your timezone.</p>
<p>Now run <code>dbt deps</code> to seal the deal by installing the <code>dbt-expectations</code> package.</p>
<pre><code>dbt deps</code></pre>
<p>Here is the output showing the successful installation of the package in our environment.</p>
<pre><code>19:31:10  Running with dbt=1.8.7
19:31:12  Updating lock file in file path: /home/sammigachuhi/dbt_book2/dbt_book/package-lock.yml
19:31:13  Installing calogica/dbt_expectations
19:31:44  Installed from version 0.10.4
19:31:44  Up to date!
19:31:44  Installing calogica/dbt_date
19:31:45  Installed from version 0.10.1
19:31:45  Up to date!
</code></pre>
</div>
<div id="types-of-dbt-expectations-tests" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Types of <code>dbt-expectations</code> tests<a href="dbt-expectations-package.html#types-of-dbt-expectations-tests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><code>dbt-expectations</code> comes with a plethora of tests’ functions which can be classified into the following categories.</p>
<ul>
<li>Table shape</li>
<li>Missing values, unique values, and types</li>
<li>Sets and ranges</li>
<li>String matching</li>
<li>Aggregate functions</li>
<li>Multi-column</li>
<li>Distributional functions</li>
</ul>
<p>We will perform one test in each category just to exemplify the potential of <code>dbt-expectations</code>.</p>
<div id="table-shape" class="section level3 hasAnchor" number="10.2.1">
<h3><span class="header-section-number">10.2.1</span> Table shape<a href="dbt-expectations-package.html#table-shape" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_table_row_count_to_equal_other_table" class="section level4 hasAnchor" number="10.2.1.1">
<h4><span class="header-section-number">10.2.1.1</span> <code>expect_table_row_count_to_equal_other_table</code><a href="dbt-expectations-package.html#expect_table_row_count_to_equal_other_table" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect the number of rows in a model match another model.</p>
<p>We will expect the <code>citi_trips_round</code> and the <code>citi_trips_minutes</code> tables to have the same number of rows since their respective models used the same <code>citi_bike_trips</code> table. Therefore, the two tables should pass this test, or will they?</p>
<p>Since we only want to concentrate on the models within the <code>my_models</code> directory, just run: <code>dbt test --select models/my_models</code></p>
<p>Here is the output.</p>
<pre><code>-- snip --
07:57:38  2 of 8 FAIL 1 dbt_expectations_expect_table_row_count_to_equal_other_table_citi_trips_minutes_ref_citi_trips_round_  [FAIL 1 in 4.83s]
07:57:38  3 of 8 START test dbt_expectations_expect_table_row_count_to_equal_other_table_citi_trips_round_ref_citi_trips_minutes_  [RUN]
07:57:42  3 of 8 FAIL 1 dbt_expectations_expect_table_row_count_to_equal_other_table_citi_trips_round_ref_citi_trips_minutes_  [FAIL 1 in 4.53s]
-- snip --
</code></pre>
<p>This leaves one puzzled, why?</p>
<p>A close look at the model for <code>citi_trips_round</code> reveals the answer. This model was designed to only work on non-null rows, unlike the <code>citi_trips_minutes</code> which worked on all rows, null or not. Therefore the <code>citi_trips_round</code> had less rows and thus the generated the error. In case your tests results seem incongruent, it is always good to recheck the models to refresh your memory, as we did here.</p>
<p>In fact, dbt did a good job of generating an SQL to show us the error:</p>
<pre><code>07:58:03  Failure in test dbt_expectations_expect_table_row_count_to_equal_other_table_citi_trips_minutes_ref_citi_trips_round_ (models/my_models/my_models.yml)
07:58:03    Got 1 result, configured to fail if != 0
07:58:03  
07:58:03    compiled code at target/compiled/dbt_book/models/my_models/my_models.yml/dbt_expectations_expect_table__c00100dada30a31f15f90b9c1ba0b295.sql</code></pre>
<p>If you click on the destination of the SQL statement and copy the contents to the SQL query tab of BigQuery, you will see the difference in row count for the two tables.</p>
<div class="float">
<img src="images/row_count_difference.png" alt="Row count difference" />
<div class="figcaption">Row count difference</div>
</div>
</div>
</div>
<div id="missing-values-unique-values-and-types" class="section level3 hasAnchor" number="10.2.2">
<h3><span class="header-section-number">10.2.2</span> Missing values, unique values, and types<a href="dbt-expectations-package.html#missing-values-unique-values-and-types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_column_values_to_not_be_null" class="section level4 hasAnchor" number="10.2.2.1">
<h4><span class="header-section-number">10.2.2.1</span> <code>expect_column_values_to_not_be_null</code><a href="dbt-expectations-package.html#expect_column_values_to_not_be_null" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect column values to not be null.</p>
<p>This is a <em>no-brainer</em> kind of test. Can you guess which columns in any of our tables in the <code>nyc_bikes</code> dataset should never be null? Here is a clue, station_id and station names, unless the biker teleports to or from somewhere!</p>
<p>So on the <code>my_models</code> YAML file, insert the below test on the <code>start_station_id</code>, <code>start_station_name</code>, <code>end_station_id</code> and <code>end_station_name</code> fields.</p>
<pre><code>tests:
  - dbt_expectations.expect_column_values_to_not_be_null</code></pre>
<p>You will get some interesting results. some of the tests fail for the <code>citi_trips_minutes</code> model because of the many null rows in the table. However, none of this particular test fail for the <code>citi_trips_round</code> table; it has zero null rows.</p>
<p>A caveat when using the <code>dbt_expectations.expect_column_values_to_not_be_null</code>, only add a colon <code>:</code> when specifying more optional parameters such as <code>row_condition: "id is not null" # (Optional)</code>. Otherwise, leave it out.</p>
</div>
</div>
<div id="sets-and-ranges" class="section level3 hasAnchor" number="10.2.3">
<h3><span class="header-section-number">10.2.3</span> Sets and Ranges<a href="dbt-expectations-package.html#sets-and-ranges" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_column_values_to_be_in_set" class="section level4 hasAnchor" number="10.2.3.1">
<h4><span class="header-section-number">10.2.3.1</span> <code>expect_column_values_to_be_in_set</code><a href="dbt-expectations-package.html#expect_column_values_to_be_in_set" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect each column value to be in a given set.</p>
<p>This test works best for where you are sure that a certain column will only accept certain values. A good example is the <code>gender</code> column. There can only be three results: male, female and other. Here we insert the test in our <code>citi_trips_minutes</code> and <code>citi_trips_round</code> models.</p>
<pre><code>- name: gender
  description: &quot;Gender (unknown, male, female)&quot;
  tests:
    - dbt_expectations.expect_column_values_to_be_in_set:
        value_set: [&#39;unknown&#39;,&#39;male&#39;,&#39;female&#39;]
</code></pre>
<p>If you run the above test for both the <code>citi_trips_minutes</code> and <code>citi_trips_round</code> models, the test will fail for the former. Why, because of the pesky null rows. However, to take the null rows into consideration and take them as accepted values in the <code>citi_trips_minutes</code> model only, we simply add an empty quotation marks, like so (<code>''</code>). Here is our modified test: <code>value_set: ['', 'unknown','male','female']</code>. The test will then pass for our <code>citi_trips_minutes</code> table.</p>
</div>
</div>
<div id="string-matching" class="section level3 hasAnchor" number="10.2.4">
<h3><span class="header-section-number">10.2.4</span> String matching<a href="dbt-expectations-package.html#string-matching" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_column_value_lengths_to_be_between" class="section level4 hasAnchor" number="10.2.4.1">
<h4><span class="header-section-number">10.2.4.1</span> <code>expect_column_value_lengths_to_be_between</code><a href="dbt-expectations-package.html#expect_column_value_lengths_to_be_between" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect column entries to be strings with length between a min_value value and a max_value value (inclusive).</p>
<p>Because our <code>citi_trips_minutes</code> table has several null rows, we will put the minimum expected value to be 0. Since we also want to catch those station names with overly long names, we will put the max value as 70. So for both the <code>start_station_name</code> and the <code>end_station_name</code>, we inserted the following test:</p>
<pre><code>tests:
  - dbt_expectations.expect_column_values_to_not_be_null
  - dbt_expectations.expect_column_value_lengths_to_be_between:
      min_value: 1 # (Optional)
      max_value: 70 # (Optional)</code></pre>
<p>We are glad to know both models passed this simple test.</p>
</div>
</div>
<div id="aggregate" class="section level3 hasAnchor" number="10.2.5">
<h3><span class="header-section-number">10.2.5</span> Aggregate<a href="dbt-expectations-package.html#aggregate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_column_max_to_be_between" class="section level4 hasAnchor" number="10.2.5.1">
<h4><span class="header-section-number">10.2.5.1</span> <code>expect_column_max_to_be_between</code><a href="dbt-expectations-package.html#expect_column_max_to_be_between" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect the column max to be between a min and max value</p>
<p>You may wonder what the purpose of this test is. But don’t dismiss it yet, it can come quite in handy when searching for outlier values. We will demonstrate it in catching overly long bike trips. However, this test needs some background knowledge of your data.</p>
<p>Applying the below queries on BigQuery will help.</p>
<pre><code>SELECT AVG(trip_duration_min) FROM dbt-project-437116.nyc_bikes.citi_trips_minutes; -- 16

SELECT MAX(trip_duration_min) FROM dbt-project-437116.nyc_bikes.citi_trips_minutes; -- 325167.48

SELECT * FROM dbt-project-437116.nyc_bikes.citi_trips_minutes
WHERE trip_duration_min &gt; 200000;</code></pre>
<p>Now lets place the limits of our maximum trip duration values to be between the average of 16 and some intermediate value such as 100, 000 minutes (1, 666 hours)!</p>
<pre><code>tests:
  - dbt_expectations.expect_column_max_to_be_between:
      min_value: 16 # (Optional)
      max_value: 100000 # (Optional)</code></pre>
<p>That will flag off some errors, but if you change the <code>max_value</code> parameter to <code>360000</code>, the tests will pass. However, in the <code>trip_min_round</code> field of the <code>citi_trips_round</code> model, we set the <code>max_value</code> as 100000 to demonstrate an error of this test.</p>
</div>
</div>
<div id="multi-column" class="section level3 hasAnchor" number="10.2.6">
<h3><span class="header-section-number">10.2.6</span> Multi-column<a href="dbt-expectations-package.html#multi-column" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="expect_column_pair_values_a_to_be_greater_than_b" class="section level4 hasAnchor" number="10.2.6.1">
<h4><span class="header-section-number">10.2.6.1</span> <code>expect_column_pair_values_A_to_be_greater_than_B</code><a href="dbt-expectations-package.html#expect_column_pair_values_a_to_be_greater_than_b" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Description: Expect values in column A to be greater than column B.</p>
<p>This kind of test comes in handy when you want to ensure that one of your columnar values is greater than, or less than that of a different column. A good example is a comparison of trip duration in seconds in the <code>tripduration</code> column versus the trip duration in minutes from <code>trip_min_round</code> column in our <code>citi_trips_round</code> table. Definitely time in seconds will always have a greater value in terms of length than the more concise minutes values!</p>
<p>In our <code>citi_trips_round</code> model, insert the test as follows:</p>
<pre><code>- name: citi_trips_round
    description: &#39;{{ doc(&quot;citi_trips_round&quot;) }}&#39;
    tests:
      - dbt_expectations.expect_table_row_count_to_equal_other_table:
          compare_model: ref(&quot;citi_trips_minutes&quot;)
      - dbt_expectations.expect_column_pair_values_A_to_be_greater_than_B:
          column_A: tripduration
          column_B: trip_min_round</code></pre>
<p>It surely does pass the test.</p>
<pre><code>-- snip --
09:40:46  5 of 26 PASS dbt_expectations_expect_column_pair_values_A_to_be_greater_than_B_citi_trips_round_tripduration__trip_min_round  [PASS in 2.20s]</code></pre>
</div>
</div>
<div id="distributional-functions" class="section level3 hasAnchor" number="10.2.7">
<h3><span class="header-section-number">10.2.7</span> Distributional functions<a href="dbt-expectations-package.html#distributional-functions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is another category of shipped-in tests of <code>dbt-expectations</code>. However, they require some statistical homework to be conducted on your data prior to applying the tests. The tests under this category include: <code>expect_column_values_to_be_within_n_moving_stdevs</code>, <code>expect_column_values_to_be_within_n_stdevs</code> and <code>expect_row_values_to_have_data_for_every_n_datepart</code>.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tests-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="seeds.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/09-dbt-expectations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
