<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Models | dbt Book</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Models | dbt Book" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Models | dbt Book" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Samuel Gachuhi Ngugi" />


<meta name="date" content="2024-11-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installing-dbt.html"/>
<link rel="next" href="documentation-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> About</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#usage"><i class="fa fa-check"></i><b>1.1</b> Usage</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#render-book"><i class="fa fa-check"></i><b>1.2</b> Render book</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#preview-book"><i class="fa fa-check"></i><b>1.3</b> Preview book</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#what-is-dbt"><i class="fa fa-check"></i><b>2.1</b> What is dbt?</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#encounter-with-dbt"><i class="fa fa-check"></i><b>2.2</b> Encounter with <code>dbt</code></a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#dbt-from-the-professionals"><i class="fa fa-check"></i><b>2.3</b> dbt, from the professionals…</a></li>
<li class="chapter" data-level="2.4" data-path="introduction.html"><a href="introduction.html#why-use-dbt"><i class="fa fa-check"></i><b>2.4</b> Why use dbt?</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html"><i class="fa fa-check"></i><b>3</b> The <code>dbt</code> architecture</a>
<ul>
<li class="chapter" data-level="3.0.1" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#models"><i class="fa fa-check"></i><b>3.0.1</b> Models</a></li>
<li class="chapter" data-level="3.0.2" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#tests"><i class="fa fa-check"></i><b>3.0.2</b> Tests</a></li>
<li class="chapter" data-level="3.0.3" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#documentation"><i class="fa fa-check"></i><b>3.0.3</b> Documentation</a></li>
<li class="chapter" data-level="3.0.4" data-path="the-dbt-architecture.html"><a href="the-dbt-architecture.html#sources"><i class="fa fa-check"></i><b>3.0.4</b> Sources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-storage.html"><a href="data-storage.html"><i class="fa fa-check"></i><b>4</b> Data storage</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-storage.html"><a href="data-storage.html#data-warehouse"><i class="fa fa-check"></i><b>4.1</b> Data warehouse</a></li>
<li class="chapter" data-level="4.2" data-path="data-storage.html"><a href="data-storage.html#data-lake"><i class="fa fa-check"></i><b>4.2</b> Data lake</a></li>
<li class="chapter" data-level="4.3" data-path="data-storage.html"><a href="data-storage.html#data-lakehouse"><i class="fa fa-check"></i><b>4.3</b> Data lakehouse</a></li>
<li class="chapter" data-level="4.4" data-path="data-storage.html"><a href="data-storage.html#a-brief-history"><i class="fa fa-check"></i><b>4.4</b> A brief history</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html"><i class="fa fa-check"></i><b>5</b> Our data in BigQuery</a>
<ul>
<li class="chapter" data-level="5.1" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html#accessing-big-query"><i class="fa fa-check"></i><b>5.1</b> Accessing Big Query</a></li>
<li class="chapter" data-level="5.2" data-path="our-data-in-bigquery.html"><a href="our-data-in-bigquery.html#copying-the-new-york-city-bikes-data"><i class="fa fa-check"></i><b>5.2</b> Copying the New York City Bikes data</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="installing-dbt.html"><a href="installing-dbt.html"><i class="fa fa-check"></i><b>6</b> Installing dbt</a>
<ul>
<li class="chapter" data-level="6.1" data-path="installing-dbt.html"><a href="installing-dbt.html#setting-the-environment"><i class="fa fa-check"></i><b>6.1</b> Setting the environment</a></li>
<li class="chapter" data-level="6.2" data-path="installing-dbt.html"><a href="installing-dbt.html#connecting-to-your-bigquery-data-warehouse"><i class="fa fa-check"></i><b>6.2</b> Connecting to your BigQuery data warehouse</a></li>
<li class="chapter" data-level="6.3" data-path="installing-dbt.html"><a href="installing-dbt.html#initializing-a-dbt-project"><i class="fa fa-check"></i><b>6.3</b> Initializing a dbt project</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="models-1.html"><a href="models-1.html"><i class="fa fa-check"></i><b>7</b> Models</a>
<ul>
<li class="chapter" data-level="7.1" data-path="models-1.html"><a href="models-1.html#running-a-model"><i class="fa fa-check"></i><b>7.1</b> Running a model</a></li>
<li class="chapter" data-level="7.2" data-path="models-1.html"><a href="models-1.html#model-structure"><i class="fa fa-check"></i><b>7.2</b> Model structure</a></li>
<li class="chapter" data-level="7.3" data-path="models-1.html"><a href="models-1.html#a-custom-model"><i class="fa fa-check"></i><b>7.3</b> A custom model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="documentation-1.html"><a href="documentation-1.html"><i class="fa fa-check"></i><b>8</b> Documentation</a>
<ul>
<li class="chapter" data-level="8.1" data-path="documentation-1.html"><a href="documentation-1.html#the-yml-files"><i class="fa fa-check"></i><b>8.1</b> The yml files</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="documentation-1.html"><a href="documentation-1.html#version-2"><i class="fa fa-check"></i><b>8.1.1</b> <code>version: 2</code></a></li>
<li class="chapter" data-level="8.1.2" data-path="documentation-1.html"><a href="documentation-1.html#models-2"><i class="fa fa-check"></i><b>8.1.2</b> <code>models</code></a></li>
<li class="chapter" data-level="8.1.3" data-path="documentation-1.html"><a href="documentation-1.html#description"><i class="fa fa-check"></i><b>8.1.3</b> <code>description</code></a></li>
<li class="chapter" data-level="8.1.4" data-path="documentation-1.html"><a href="documentation-1.html#columns"><i class="fa fa-check"></i><b>8.1.4</b> <code>columns</code></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="documentation-1.html"><a href="documentation-1.html#definition-for-our-model"><i class="fa fa-check"></i><b>8.2</b> Definition for our model</a></li>
<li class="chapter" data-level="8.3" data-path="documentation-1.html"><a href="documentation-1.html#using-the-doc-function"><i class="fa fa-check"></i><b>8.3</b> Using the <code>doc</code> function</a></li>
<li class="chapter" data-level="8.4" data-path="documentation-1.html"><a href="documentation-1.html#images-in-dbt-documentation"><i class="fa fa-check"></i><b>8.4</b> Images in dbt documentation</a></li>
<li class="chapter" data-level="8.5" data-path="documentation-1.html"><a href="documentation-1.html#generating-the-document"><i class="fa fa-check"></i><b>8.5</b> Generating the document</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tests-1.html"><a href="tests-1.html"><i class="fa fa-check"></i><b>9</b> Tests</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tests-1.html"><a href="tests-1.html#types-of-tests-in-dbt"><i class="fa fa-check"></i><b>9.1</b> Types of tests in dbt</a></li>
<li class="chapter" data-level="9.2" data-path="tests-1.html"><a href="tests-1.html#generic-tests-in-dbt"><i class="fa fa-check"></i><b>9.2</b> Generic tests in dbt</a></li>
<li class="chapter" data-level="9.3" data-path="tests-1.html"><a href="tests-1.html#singular-tests-in-dbt"><i class="fa fa-check"></i><b>9.3</b> Singular tests in dbt</a></li>
<li class="chapter" data-level="9.4" data-path="tests-1.html"><a href="tests-1.html#creating-a-generic-test"><i class="fa fa-check"></i><b>9.4</b> Creating a generic test</a></li>
<li class="chapter" data-level="9.5" data-path="tests-1.html"><a href="tests-1.html#configuring-custom-generic-tests"><i class="fa fa-check"></i><b>9.5</b> Configuring custom generic tests</a></li>
<li class="chapter" data-level="9.6" data-path="tests-1.html"><a href="tests-1.html#storing-test-failures"><i class="fa fa-check"></i><b>9.6</b> Storing test failures</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html"><i class="fa fa-check"></i><b>10</b> dbt Expectations package</a>
<ul>
<li class="chapter" data-level="10.1" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#dbt-expectations-installation"><i class="fa fa-check"></i><b>10.1</b> <code>dbt-expectations</code> installation</a></li>
<li class="chapter" data-level="10.2" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#types-of-dbt-expectations-tests"><i class="fa fa-check"></i><b>10.2</b> Types of <code>dbt-expectations</code> tests</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#table-shape"><i class="fa fa-check"></i><b>10.2.1</b> Table shape</a></li>
<li class="chapter" data-level="10.2.2" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#missing-values-unique-values-and-types"><i class="fa fa-check"></i><b>10.2.2</b> Missing values, unique values, and types</a></li>
<li class="chapter" data-level="10.2.3" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#sets-and-ranges"><i class="fa fa-check"></i><b>10.2.3</b> Sets and Ranges</a></li>
<li class="chapter" data-level="10.2.4" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#string-matching"><i class="fa fa-check"></i><b>10.2.4</b> String matching</a></li>
<li class="chapter" data-level="10.2.5" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#aggregate"><i class="fa fa-check"></i><b>10.2.5</b> Aggregate</a></li>
<li class="chapter" data-level="10.2.6" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#multi-column"><i class="fa fa-check"></i><b>10.2.6</b> Multi-column</a></li>
<li class="chapter" data-level="10.2.7" data-path="dbt-expectations-package.html"><a href="dbt-expectations-package.html#distributional-functions"><i class="fa fa-check"></i><b>10.2.7</b> Distributional functions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="seeds.html"><a href="seeds.html"><i class="fa fa-check"></i><b>11</b> Seeds</a>
<ul>
<li class="chapter" data-level="11.1" data-path="seeds.html"><a href="seeds.html#uploading-a-seed-into-your-data-warehouse"><i class="fa fa-check"></i><b>11.1</b> Uploading a seed into your data warehouse</a></li>
<li class="chapter" data-level="11.2" data-path="seeds.html"><a href="seeds.html#referencing-seeds-in-models"><i class="fa fa-check"></i><b>11.2</b> Referencing seeds in models</a></li>
<li class="chapter" data-level="11.3" data-path="seeds.html"><a href="seeds.html#seed-configurations-at-project-level"><i class="fa fa-check"></i><b>11.3</b> Seed Configurations at project level</a></li>
<li class="chapter" data-level="11.4" data-path="seeds.html"><a href="seeds.html#seed-properties-and-configurations-at-properties-level"><i class="fa fa-check"></i><b>11.4</b> Seed properties and configurations at properties level</a></li>
<li class="chapter" data-level="11.5" data-path="seeds.html"><a href="seeds.html#performing-tests-on-seeds"><i class="fa fa-check"></i><b>11.5</b> Performing tests on seeds</a></li>
<li class="chapter" data-level="11.6" data-path="seeds.html"><a href="seeds.html#viewing-documentation-for-dbt-seeds"><i class="fa fa-check"></i><b>11.6</b> Viewing documentation for dbt seeds</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="sources-1.html"><a href="sources-1.html"><i class="fa fa-check"></i><b>12</b> Sources</a>
<ul>
<li class="chapter" data-level="12.1" data-path="sources-1.html"><a href="sources-1.html#defining-a-source"><i class="fa fa-check"></i><b>12.1</b> Defining a source</a></li>
<li class="chapter" data-level="12.2" data-path="sources-1.html"><a href="sources-1.html#referencing-sources"><i class="fa fa-check"></i><b>12.2</b> Referencing sources</a></li>
<li class="chapter" data-level="12.3" data-path="sources-1.html"><a href="sources-1.html#defining-properties-in-a-sources-file"><i class="fa fa-check"></i><b>12.3</b> Defining properties in a <code>sources</code> file</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="snapshots.html"><a href="snapshots.html"><i class="fa fa-check"></i><b>13</b> Snapshots</a>
<ul>
<li class="chapter" data-level="13.1" data-path="snapshots.html"><a href="snapshots.html#create-a-snapshot"><i class="fa fa-check"></i><b>13.1</b> Create a snapshot</a></li>
<li class="chapter" data-level="13.2" data-path="snapshots.html"><a href="snapshots.html#the-check-strategy"><i class="fa fa-check"></i><b>13.2</b> The <code>check</code> strategy</a></li>
<li class="chapter" data-level="13.3" data-path="snapshots.html"><a href="snapshots.html#the-timestamp-strategy"><i class="fa fa-check"></i><b>13.3</b> The <code>timestamp</code> strategy</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="analyses.html"><a href="analyses.html"><i class="fa fa-check"></i><b>14</b> Analyses</a>
<ul>
<li class="chapter" data-level="14.1" data-path="analyses.html"><a href="analyses.html#creating-an-analysis"><i class="fa fa-check"></i><b>14.1</b> Creating an <code>analysis</code></a></li>
<li class="chapter" data-level="14.2" data-path="analyses.html"><a href="analyses.html#definitions-for-analyses"><i class="fa fa-check"></i><b>14.2</b> Definitions for <code>analyses</code></a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="exposures.html"><a href="exposures.html"><i class="fa fa-check"></i><b>15</b> Exposures</a>
<ul>
<li class="chapter" data-level="15.1" data-path="exposures.html"><a href="exposures.html#creating-an-exposure"><i class="fa fa-check"></i><b>15.1</b> Creating an exposure</a></li>
<li class="chapter" data-level="15.2" data-path="exposures.html"><a href="exposures.html#visualizing-the-exposure"><i class="fa fa-check"></i><b>15.2</b> Visualizing the exposure</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="jinja.html"><a href="jinja.html"><i class="fa fa-check"></i><b>16</b> Jinja</a>
<ul>
<li class="chapter" data-level="16.1" data-path="jinja.html"><a href="jinja.html#a-simple-jinja-statement"><i class="fa fa-check"></i><b>16.1</b> A simple jinja statement</a></li>
<li class="chapter" data-level="16.2" data-path="jinja.html"><a href="jinja.html#a-more-complex-jinja-query"><i class="fa fa-check"></i><b>16.2</b> A more complex jinja query</a></li>
<li class="chapter" data-level="16.3" data-path="jinja.html"><a href="jinja.html#improvising-using-dry-principle"><i class="fa fa-check"></i><b>16.3</b> Improvising using DRY Principle</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="macros.html"><a href="macros.html"><i class="fa fa-check"></i><b>17</b> Macros</a>
<ul>
<li class="chapter" data-level="17.1" data-path="macros.html"><a href="macros.html#invoking-a-macro"><i class="fa fa-check"></i><b>17.1</b> Invoking a macro</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="macros.html"><a href="macros.html#invoking-a-macro-using-expression-blocks"><i class="fa fa-check"></i><b>17.1.1</b> Invoking a macro using expression blocks</a></li>
<li class="chapter" data-level="17.1.2" data-path="macros.html"><a href="macros.html#invoke-a-macro-using-call-blocks"><i class="fa fa-check"></i><b>17.1.2</b> Invoke a macro using call blocks</a></li>
<li class="chapter" data-level="17.1.3" data-path="macros.html"><a href="macros.html#invoke-a-macro-from-the-command-line-interface-cli"><i class="fa fa-check"></i><b>17.1.3</b> Invoke a macro from the Command Line Interface (CLI)</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="macros.html"><a href="macros.html#simple-macro"><i class="fa fa-check"></i><b>17.2</b> Simple macro</a></li>
<li class="chapter" data-level="17.3" data-path="macros.html"><a href="macros.html#complex-macro"><i class="fa fa-check"></i><b>17.3</b> Complex macro</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">dbt Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="models-1" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Models<a href="models-1.html#models-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>If you have gone through previous chapters, you will by now know that a model in dbt is any SQL file. It is what dbt will use to build tables, views and any other transformations in your data warehouse (read BigQuery).</p>
<p>In dbt, models are executed with the hit and run command: <code>dbt run</code>.</p>
<div id="running-a-model" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Running a model<a href="models-1.html#running-a-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>dbt did us a very big favour during installation, it came with two models already created for us. These are namely the <code>my_first_dbt_model.sql</code> and <code>my_second_dbt_model.sql</code> within the <code>models/example</code> directory. It also provided a <code>schema.yml</code> file within the same directory which provides definitions for the model’s schema.</p>
<p>Alright. Assuming that you are within the <code>dbt_book</code> subdirectory and your virtual environment <code>(venv)</code> already activated, type the following in your terminal <code>dbt run</code>.</p>
<pre><code>(venv) sammigachuhi@Gachuhi:~/dbt_book/dbt_book$ dbt run</code></pre>
<p>This will initiate a series of printouts. However, before we go to the expected output, you may run into an error related to the location not being found.</p>
<pre><code>404 Not found: Dataset dbt-project-437116:nyc_bikes was not found in location US; reason: notFound, message: Not found: Dataset dbt-project-437116:nyc_bikes was not found in location US</code></pre>
<p>When we were initializing our project using <code>dbt init</code> we selected option 1 for US since there was no other option apart from EU. Luckily, there is a work around to this. It involves editing the <code>projects.yml</code> file. If you run <code>dbt debug</code> it will also show the path of your <code>projects.yml</code> alongside other configuration information.</p>
<pre><code>18:19:56  Running with dbt=1.8.7
18:19:56  dbt version: 1.8.7
18:19:56  python version: 3.10.12
18:19:56  python path: /home/sammigachuhi/dbt_book/venv/bin/python3
18:19:56  os info: Linux-5.15.153.1-microsoft-standard-WSL2-x86_64-with-glibc2.35
18:19:57  Using profiles dir at /home/sammigachuhi/.dbt
18:19:57  Using profiles.yml file at /home/sammigachuhi/.dbt/profiles.yml
--snip--</code></pre>
<p>Go to the provided path for <code>profiles.yml</code> which is found at <code>/home/sammigachuhi/.dbt</code> in my case. Open it and change the line with <code>location</code> to read from <code>US</code> to <code>africa-south1</code>.</p>
<pre><code>dbt_book:
  outputs:
    dev:
      dataset: nyc_bikes
      job_execution_timeout_seconds: 300
      job_retries: 1
      keyfile: /home/sammigachuhi/dbt_credentials/dbt_book.json
      location: africa-south1 
--snip---</code></pre>
<p>Now come back, and rerun <code>dbt run</code> again. dbt should now be able to run against your warehouse and create a table called <code>my_first_dbt_model</code> and a view <code>my_second_dbt_model</code> in BigQuery.</p>
<p>“How do I know that my queries ran successfully?”, you may ask. One, the output of a successful dbt run is <code>Completed successfully</code>. Beneath this, message, will be a log of the number of models ran and if there have been any errors. We had two models, so we expect to see this reflect in the log. And it did.</p>
<pre><code>18:21:16  Running with dbt=1.8.7
18:21:17  Registered adapter: bigquery=1.8.2
18:21:17  Unable to do partial parsing because saved manifest not found. Starting full parse.
18:21:19  Found 2 models, 4 data tests, 479 macros
18:21:19  
18:21:22  Concurrency: 1 threads (target=&#39;dev&#39;)
18:21:22  
18:21:22  1 of 2 START sql table model nyc_bikes.my_first_dbt_model ...................... [RUN]
18:21:30  1 of 2 OK created sql table model nyc_bikes.my_first_dbt_model ................. [CREATE TABLE (2.0 rows, 0 processed) in 7.83s]
18:21:30  2 of 2 START sql view model nyc_bikes.my_second_dbt_model ...................... [RUN]
18:21:34  2 of 2 OK created sql view model nyc_bikes.my_second_dbt_model ................. [CREATE VIEW (0 processed) in 4.01s]
18:21:34  
18:21:34  Finished running 1 table model, 1 view model in 0 hours 0 minutes and 14.88 seconds (14.88s).
18:21:34  
18:21:34  Completed successfully
18:21:34  
18:21:34  Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
</code></pre>
<p>The second way, and the most obvious, is checking the results in your BigQuery data warehouse. If you see the table and view <code>my_first_dbt_model</code> and <code>my_second_dbt_model</code> respectively, the query ran successfully.</p>
<div class="float">
<img src="images/model_outputs.png" alt="Models" />
<div class="figcaption">Models</div>
</div>
<p>It was that simple, isn’t it?</p>
</div>
<div id="model-structure" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Model structure<a href="models-1.html#model-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s take a look at the model <code>my_first_dbt_model.sql</code>.</p>
<pre><code>
{{ config(materialized=&#39;table&#39;) }}

with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data

/*
    Uncomment the line below to remove records with null `id` values
*/

-- where id is not null</code></pre>
<p>The line <code>{{ config(materialized='table') }}</code> tells dbt to make the output <code>my_first_dbt_model</code> as a table. Any configurations set at the model level will overide the overarching ones set at <code>dbt_project.yml</code> file.</p>
<p>If you quickly take a sneek peek at the <code>dbt_project.yml</code> file and scroll to the bottom, you will see this configuration:</p>
<pre><code>models:
  dbt_book:
    # Config indicated by + and applies to all files under models/example/
    example:
      +materialized: view</code></pre>
<p>This configuration simply says that for every model inside the <code>dbt_book/example</code> directory, as displayed by the new line and identations, materialize the result as a view<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. However, inside our <code>my_first_dbt_model.sql</code> file, we set the materialization as <code>table</code>. What is in the sql model will override what is in the <code>dbt_project.yml</code>. However, for <code>my_second_dbt_model.sql</code>, we didn’t specify the materialization. Like the case of the rat reigning in the cat’s absence, the materialization specified in the <code>dbt_project.yml</code> will call the shots for the second model. That’s why for <code>my_second_dbt_model</code> the materialization is a view, and not a table as its counterpart.</p>
<p><a href="https://docs.getdbt.com/docs/build/materializations">Materialization</a> is the persistence of a model in the data warehouse.</p>
<p>The second part of our first model is the actual SQL statement.</p>
<pre><code>with source_data as (

    select 1 as id
    union all
    select null as id

)

select *
from source_data</code></pre>
<p>This is a WITH SQL statement. In very simple terms, the SQL statement in parentheses <code>()</code> is what is referenced as <code>source_data</code>. Once we define our SQL statement and close it with parentheses, we can now select the data referenced by <code>source_data</code>.</p>
<p>The SQL statements in parentheses is what is referred to as <a href="https://www.atlassian.com/data/sql/using-common-table-expressions">Common Table Expression (CTE)</a>. They were designed to simplify complex queries and be used in the context of a larger query.</p>
<p>The second model doesn’t have much to provide but it introduces a new trick: the <code>ref</code> function.</p>
<pre><code>select *
from {{ ref(&#39;my_first_dbt_model&#39;) }}
where id = 1</code></pre>
<p>The <code>ref</code> function is part of the jinja templating language. It is used to reference a model that has been provided within the parentheses enclosed with quotes <code>('')</code>. Therefore, in essence, our model is simply returning the row(s) from <code>my_first_dbt_model</code> that contain the value <code>1</code> in the <code>id</code> column.</p>
<p>Here is the result of <code>my_second_dbt_model</code> view when I query BigQuery to show its contents.</p>
<div class="float">
<img src="images/second_model.png" alt="Second model" />
<div class="figcaption">Second model</div>
</div>
</div>
<div id="a-custom-model" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> A custom model<a href="models-1.html#a-custom-model" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Now that we have seen how to run our models, and we have hit the ground running with some of the models preshipped with dbt, it’s now time to fold our shirts and run our own custom model.</p>
<p>Let’s start easy. We will be no means delve into a complex model since that is only limited by your imagination. If you know SQL, there is no limit to the models, both in number and complexity, that you can do in dbt.</p>
<p>Our first model will endeavour to perform a change on the <code>citi_trips</code> table within our <code>nyc_bikes</code> dataset. There is a very ripe column called <code>tripduration</code> which stands for the trip in second every cab ride took. Humans prefer to work in minutes so a trivial dbt job would involve creating a column that shows the <code>tripduration</code> in minutes. dbt would then be doing the Transform part in the ELT.</p>
<p>In the <code>citi_trips_minutes.sql</code> model, we have written a code that creates a view of this result. Remember, views are just virtual tables but they do save on storage!</p>
<pre><code>{{ config(materialized=&#39;view&#39;) }}

WITH citi_trips AS (
    SELECT *, 
    tripduration / 60 AS trip_duration_min
    FROM 
    `dbt-project-437116.nyc_bikes.citibike_trips` 
)

SELECT * FROM citi_trips
</code></pre>
<p>The above SQL statement is also a form of Common Table Expression (CTE). It’s not that hard. The variable <code>citi_trips</code> just references the SQL statement in parentheses.</p>
<p>There is another small trick of the trade. What if this very simple dbt model was just part of thousands, and longer running SQL models. If we wanted to just run this small, tiny winy model, would it have to be part of the entourage of the other model runs. Such would be a waste of time and resources, assuming some of them are heavy models. No. We can use the <code>--select</code> keyword to only select the model we want to run.</p>
<p>Below we run the <code>citi_trips_minutes</code> model.</p>
<pre><code>dbt run --select models/example/citi_trips_minutes.sql
</code></pre>
<p>Below is the output.</p>
<pre><code>Concurrency: 1 threads (target=&#39;dev&#39;)
18:50:33  
18:50:33  1 of 1 START sql view model nyc_bikes.citi_trips_minutes ....................... [RUN]
18:50:37  1 of 1 OK created sql view model nyc_bikes.citi_trips_minutes .................. [CREATE VIEW (0 processed) in 4.53s]
18:50:37  
18:50:37  Finished running 1 view model in 0 hours 0 minutes and 8.17 seconds (8.17s).
18:50:37  
18:50:37  Completed successfully
18:50:37  
18:50:37  Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1</code></pre>
<p>We are always glad when we see the soothing words “Completed successfully”. If you go to BigQuery, our data warehouse, you will see a new view called <code>citi_trips_minutes</code> already created. By default, the name of the newly formed view or table in the data warehouse will be that of the model used to create it.</p>
<p>Similar to the above, the below run command will also work.</p>
<pre><code>dbt run --select citi_trips_minutes</code></pre>
<p>But how do we view this newly created result. Unlike a table, BigQuery does not offer the <strong>PREVIEW</strong> button. However, there is a way…</p>
<div class="float">
<img src="images/query_button.png" alt="Query" />
<div class="figcaption">Query</div>
</div>
<p>Click on the <strong>Query</strong> button, select <strong>In new tab</strong> and a new tab will form. Copy this SQL query onto the tab and run it to display the result of our <code>citi_trips_minutes</code> view.</p>
<pre><code>SELECT * FROM `dbt-project-437116.nyc_bikes.citi_trips_minutes` 
</code></pre>
<p>Our <code>trip_duration_min</code> column of interest is onto the far right of our view.</p>
<p>We had hinted earlier that there is no limit to the complexity or number of models you can create in dbt. Below is a sort of more complex model (but not much) compared to the earlier one. This model rounds of the minutes to one decimal place and also removes the null columns, thus reducing number of rows from 58, 937, 715 to 53, 108, 721. The model is saved as <code>citi_trips_round.sql</code>.</p>
<pre><code>{{ config(materialized=&#39;view&#39;) }}

WITH citi_trips_round AS (
    SELECT *, ROUND(trip_duration_min, 1) AS trip_min_round
    FROM (
        SELECT *, 
        tripduration / 60 AS trip_duration_min
        FROM 
        `dbt-project-437116.nyc_bikes.citibike_trips`
        ) 
    WHERE tripduration IS NOT NULL
)

SELECT * FROM citi_trips_round
</code></pre>
<p>Our model is saved as the <code>citi_trips_round</code> view in BigQuery.</p>
<p>Create a new query tab in BigQuery to view the results. Also use the query tab to count the number of rows and compare that with those from the <code>citibike_trips</code> table. It’s a difference of 5.8 million rows of null value eliminated.</p>
<pre><code>SELECT * FROM `dbt-project-437116.nyc_bikes.citi_trips_round`; 

SELECT COUNT(*) FROM `dbt-project-437116.nyc_bikes.citi_trips_round`;

-- This is the count of the original citibike_trips table
SELECT COUNT(*) FROM `dbt-project-437116.nyc_bikes.citibike_trips`;</code></pre>
<p>You may be wondering what the advantage that dbt provides. After all, can’t one just use the SQL Query tab in BigQuery just to do the transformations and save the table? Fine, that can work. However, dbt offers a form of persistence to your models. You see, an SQL query tab can be erased or modified, but the SQL queries in dbt even if they too can be modified at will they are persisted longer if they are saved in a versioning environment such as Github.</p>
<p>One more thing, you don’t have to use the <code>models/example</code> folder. You can choose to rename this one, or save the two models we created in a different folder. They will still run fine. In fact, like a stubbon mathematician who will want to battle-test his concepts though they are as robust as Zeus, let’s do it.</p>
<p>Create a new folder within the <code>models</code> directory called <code>my_models</code>. Move the <code>citi_trips_minutes</code> and <code>citi_trips_round</code> models into the <code>my_models</code> directory. Thereafter, run these two models using <code>dbt run --select models/my_models</code>. The should run fine.</p>
<p>As an extra bit of information, all successfull compile and run models will appear under the <code>/target</code> directory.</p>

</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>A view is a virtual table, similar to the original table, the physical dataset it was created from<a href="models-1.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installing-dbt.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="documentation-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/06-models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
